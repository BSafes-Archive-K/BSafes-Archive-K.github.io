---
layout: default
title: Literature Review
parent: § Kerberoasting - Case Studies of an Attack on a Cryptographic Authentication Technology  
grand_parent: K
nav_order: 20 
---
<style>
.dont-break-out {
  /* These are technically the same, but use both */
  overflow-wrap: break-word;
  word-wrap: break-word;

     -ms-word-break: break-all;
  /* This is the dangerous one in WebKit, as it breaks things wherever */
  word-break: break-all;
  /* Instead use this non-standard one: */
  word-break: break-word;
}

.youtube-container {
    position: relative;
    width: 100%;
    height: 0;
    padding-bottom: 56.25%;
}
.youtube-video {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

</style>

<div class="dont-break-out" markdown="1">

1. TOC
{:toc}

## Literature Review
### *Network Security*
Network security is an approach used to combat the security concerns of the internet. Network security relies on two basic goals: (a) prevent unauthorized individuals from accessing resources and (b) provide access to resources for individuals who are authorized (Shinder, 2001). Firewalls are one way in which some sites try to fix their network security problems. The issue with firewalls is that they are only effective if that threat is coming from outside. They are, therefore, moot when the threat is initiated from within an enterprise. Another weakness of firewalls is that they can limit how users utilize the internet. This is because increased security often means decreased access (MIT, 2021). For example, if a firewall has rules restricting websites that do not use encryption (i.e., HTTP), users’ access to websites is limited to only those using encryption (i.e., HTTPS). Another example is that firewall rules can be created to block traffic on a certain Transmission Control Protocol (TCP) port. If a user is trying to access a service that utilizes a port blocked by the user’s enterprise firewall, the user will receive an error message and be forbidden from accessing the resource.

A more productive way to achieve network security is by assigning access permissions, which dictate the users who have access to or are prohibited from accessing specific resources based on different circumstances. The problem with access permissions or other methods that rely on user identity is that they are only successful if the identity of the user can be verified. To mitigate this concern, authentication technologies are implemented to help confirm a user’s identity (Shinder, 2001). Authentication can be used to verify the identity of an object, service, or person (Gerend, dknappettmsft, Downie, Ross, Parente, Coulter, et al., 2021). The theory behind authentication is that the provided individualized credentials verify the authentication of the user or object and grant access to a system or data (Shinder, 2001). The goal of authentication is to verify whether the object is genuine or verify that the presented service or person’s credentials are authentic (Gerend, dknappettmsft, Downie, Ross, Parente, Coulter, et al., 2021).

According to Gerend and colleagues (2021), authentication is also helpful in terms of network security. In this context, the goal is to prove client-side identity to a network application or resource located on the server-side. Identity is commonly proven with a cryptographic system that uses a key known only to the user (i.e., a private key) or a shared key. During an authentication exchange, the server-side compares the received signed data with the known key. If there is a match, the authentication attempt can be validated by the server-side. The authentication process is made manageable by storing the keys in a secure central location. The recommended and default technology for storing identity information is Active Directory Domain Services, and it is required for certain default authentication protocols. Techniques for authentication include something the user knows (e.g., a password), something the user has (e.g., a token), and something the user is (e.g., biometrics). At an enterprise, several applications or resources spread across servers, either in one location or across multiple, may be accessed by services or users. This means that authentication must work for environments on other platforms and for other Windows operating systems (OS) (Gerend, dknappettmsft, Downie, Ross, Parente, Coulter, et al., 2021).

Many methods and protocols have been used to achieve the authentication exchange specific to networks. The method or protocol is usually selected based on the application and security requirements (Shinder, 2001). For the Windows OS, there are a default set of network authentication protocols used, including New Technology LAN Manager (NTLM), Transport Layer Security/Secure Sockets Layer (TLS/SSL), Digest, and Kerberos. Additionally, some protocols are joined into an authentication package. Authentication of users, computers, and services is provided by these protocols and packages, which allows those authorized to securely access the requested resources (Gerend, dknappettmsft, Downie, Ross, Parente, Coulter, et al., 2021)

### *Cryptography*
Cryptography uses mathematical approaches to information security issues such as confidentiality; the integrity of data; and authentication of a user, server, or data origin (Menezes et al., 1997; Paar & Pelzl, 2009). Cryptography can be achieved by cryptosystems, or combinations of software and hardware which are used to convert plaintext messages to an unreadable string of characters (i.e., ciphertext) and then back to plaintext (Zwicke, 2003). This concept can be traced all the way back to ancient times, where evidence of secret writing can be found across most civilizations with developed written languages (Paar & Pelzl, 2009). By current standards, these historical ciphers, which were considered to be state of the art for their time, are significantly inadequate for achieving the level of security sought today.

The lack of security measures is cause for more significant concerns when considering the number of malicious tools available to bad actors and the fact that new tools can be easily created with just a few lines of code. For example, applications which send passwords unencrypted over a network are vulnerable to password sniffing tools used by attackers. There are also client/server applications that trust the client program to be truthful about the identity of the active user or rely on the client to restrict its own activities with no policing by the server (MIT, 2021). Increasing communication technology via the internet also requires safe communication and promoting encryption techniques, such as cryptography, digital signatures, steganography, watermarking, and other applications. Therefore, the advancement of written languages and communication technologies has driven the development of additional cryptographic techniques, especially to promote better network security. While cryptography is used to address a variety of data security issues, this paper will focus on the use of cryptography for authentication, specifically the Kerberos authentication process and its respective attack vector, Kerberoasting.

### *Kerberos*
Authentication protocols rely on a combination of encryption and authentication methods to provide access to only those with proper authorization. A few authentication protocols exist for providing security in different scenarios. Some examples include the Secure Socket Layer (SSL), the Password Authentication Protocol (PAP), the Challenge Handshake Authentication Protocol (CHAP), and Kerberos (Pandya et al., 2015). The SSL is a common method used to give secure access to websites using a combination of symmetric encryption and public keys. The PAP, although generally insecure, is typically used to establish user authentication over a remote access control system. Shiva PAP is a variate of PAP, which encrypts the user passwords before sending it to the remote server. The CHAP uses a hashing algorithm known as MD5 to hash the password before sending it over the network to gain remote access to a system. Kerberos, a network authentication protocol, enables secure authentication for clients and servers using a secret key (Pandya et al., 2015). Even though various authentication protocols are essential to address and review to better understand network security, this paper focuses on cryptography-based authentication, Kerberos.

Kerberos was developed by the Massachusetts Institute of Technology (MIT) as a network authentication protocol to address the problems with network security. When a client and a server are connected via an insecure network, the Kerberos protocol provides a way for them to authenticate their identities to each other using strong cryptography. Once they have authenticated with each other, the client and server can also encrypt their correspondence for privacy and data integrity assurance (MIT, 2021).

Windows OS currently utilizes version five of Kerberos and extensions for public key authentication, transportation of authorization data, and delegation. A security support provider (SSP) allows for the implementation of the Kerberos authentication client, which means the Kerberos authentication client can be accessed through the Security Support Provider Interface (SSPI). The Winlogon single sign-on architecture includes initial user authentication. Kerberos employs a Key Distribution Center (KDC), which is integrated with other Windows Server security services running on the domain controller. The KDC requires a security account database, so it uses the domain’s Active Directory Domain Services database (Gerend, dknappettmsft, Downie, Ross, Parente, Poggemeyer, et al., 2021).

The Kerberos authentication process can be explained in six steps, as shown in Figure 1. First, a client wishing to access a service sends a request for an authentication ticket (i.e., ticket-granting ticket [TGT]) to the authentication server. Next, the authentication server verifies the client’s right to access the resources and returns an encrypted TGT and a session key. Third, the client sends the TGT, along with the requested resource, to the Ticket-Granting Service (TGS), which is usually the KDC. The TGS then provides a service-specific valid session key to the client. The client then presents the key to the service directly. In return, the service grants access to the now authorized client (Bhakhra & yogyaarora25, 2020; “Identity and Access Management,” n.d.).

Halback (n.d.) provides the example of a carnival as an analogous way to think of Kerberos. When you arrive at a carnival, you have to go through the front entrance, where you receive a wrist band. This is similar to when you turn on your computer and enter your credentials to access your corporate network. During this process, your computer requests the TGS (a wrist band) from the domain controller to enter the realm (carnival). Once inside the carnival, you must go to a ticket booth and purchase tickets in order to ride the rides. The rides are equivalent to accessing a file share server containing your work files and the tickets are equivalent to the service-specific valid session key and ticket. Once you receive tickets (ticket and session key), you wait in line for a specific ride (file server). The ride attendant confirms that you are tall enough and of age to ride, takes your ticket, and grants you access onto the ride. This is akin to the client presenting the session key and ticket to the file server, which would provide access to the files, providing the client has permission. Your ticket would only allow you access to the ride (server) that one time. If you wanted to ride again (access the server again), or ride another ride (access a different server), you would have to revisit the ticket booth and start the process over again (Halbach, n.d.).


![Figure 1. Kerberos authentication process](https://statics.bsafes.com/images/papers/Kerberoasting-Case-Studies-of-an-Attack-on-a-Cryptographic-Authentication-Technology-fig-1.png)
Figure 1. Kerberos authentication process

The benefits of using Kerberos for domain-based authentication are delegated authentication, single sign on, interoperability, streamlined authentication to servers, and mutual authentication. Delegated authentication is achieved because Kerberos authentication allows for service to act in the place of its client . Single sign on allows a user or service to maintain access to resources without repeated credential requests. Kerberos maintains credentials after the initial Winlogon domain sign on. The Kerberos protocol provides a foundation for working with other networks using the same protocol, making it interoperable. Kerberos streamlines authentication to servers by alleviating the need for pass-through authentication and replaces it with renewable session tickets. Kerberos does not assume that servers are genuine. Therefore, it allows for mutual authentication, meaning that the server can verify the client, but the client can also verify the server (Gerend, dknappettmsft, Downie, Ross, Parente, Poggemeyer, et al., 2021).

Some additional advantages to using Kerberos as a network authentication protocol include the difficuly of reusing a ticket due to their quick expiration and strong authentication needs, the constant encryption of passwords, and the efficiency granted by sharing secret keys. There are, however, a couple of disadvantages to note. One limitation is that Kerberos is vulnerable to weak or repeated passwords. The other is that authentication is limited to servers and clients (Bhakhra & yogyaarora25, 2020; Tawde, n.d.).

### *Kerberoasting*
Kerberoasting was discovered by Tim Medin, who presented on the attack for the first time in 2014 at DerbyCon (Kotlaba et al., 2020, 2021; Medin, 2014; *Qomplx Knowledge: Kerberoasting Attacks Explained,* 2021). The goal of Kerberoasting is to retrieve credentials of Active Directory service accounts without permission or escalation of privileges (Kotlaba et al., 2020; *Qomplx Knowledge: Kerberoasting Attacks Explained,* 2021), and it is one of the most common attacks suffered by domain controllers (Ghosal, n.d.). It is pervasive in nature and lends itself to bad actors with any level of experience because the technique does not need to be carried out by an administrator; instead, it can be implemented by any user on a domain (*Qomplx Knowledge: Kerberoasting Attacks Explained*, 2021). The only prerequisite to Kerberoasting is that an attacker must already have access to a compromised system, but a complete compromise of the Windows domain is not required (Medin, 2014; Motero et al., 2021; *Qomplx Knowledge: Kerberoasting Attacks Explained,* 2021).

As previously mentioned, the TGS provides a service ticket to a client based on the specific resource to which the client requested access. These TGS tickets are then encrypted using RC4_HMAC_MD5 (i.e., the New Technology LAN Manager (NTLM) hash of the service account belonging to the resource requested by the client). Service Principal Names (SPNs) are used in Windows to identify which service accounts are used to encrypt TGS tickets. SPNs can be linked to either domain user or host-based accounts. Host-based accounts have a randomly generated 128-character long password which is changed every 30 days (Metcalf, 2017a; Motero et al., 2021; *Qomplx Knowledge: Kerberoasting Attacks Explained,* 2021; Schneider, 2018). The significant length of the password and its short lifespan make it practically impossible to guess, even with a modern kit of password cracking tools and powerful hardware (Motero et al., 2021; *Qomplx Knowledge: Kerberoasting Attacks Explained*, 2021). Kerberoasting instead relies upon the fallibility that comes from passwords generated by humans for domain user accounts. These passwords are often weak, seldom updated, and thus, easily cracked (Motero et al., 2021; *Qomplx Knowledge: Kerberoasting Attacks Explained*, 2021; Schneider, 2018).

This is where the Kerberos authentication protocol becomes vulnerable. The protocol allows a domain user to request a TGS ticket from a domain controller for any service on the network with a registered SPN. The domain controller fails to check whether the user making the request has the authorization to access the resource. The service is responsible for credential verification, which creates an opportunity for an offline attack (*Qomplx Knowledge: Kerberoasting Attacks Explained*, 2021; Schneider, 2018). The NTLM hash encryption of the ticket allows for the ticket to be subject to brute force attacks offline in an attempt to expose credentials stored in plaintext (Praetorian, 2022; Schneider, 2018). Simply stated, in a Kerberoasting attack, a TGS service ticket can be requested by a valid domain account for any service, which allows for the opportunity to crack passwords offline using the ticket (Schneider, 2018).

Thinking about the carnival analogy, unlike ride tickets which are printed with basic ticket information, the tickets in the Kerberos process have an abundance of information printed on them. This information includes the domain name of the service account, and the ticket is encrypted with the client’s account password hash. While this password hash is necessary for the Kerberos process to finish, it is also the focus of bad actors for use in offline password cracking attempts (Halbach, n.d.). If successfully cracked, this information can allow a hacker to maintain persistence, escalate privilege, or move laterally in the system (Medin, 2014; Praetorian, 2022).

Kerberoasting attacks are prevalent because they require basic skills to implement and their very nature shields adversaries from detection. A successful Kerberoasting attack allows an adversary to navigate a system masked as an approved user. It is atypical for a cybersecurity detection tool to analyze behavior of approved users. Acting as an approved user makes it unlikely that these tools would detect adversary activity. These attacks also do not require the use of malware, making them immune to defensive technologies such as antivirus software. The fact that adversaries can conduct the password cracking offline means that they do not produce any suspicious network traffic or transmit data packets. This means the activity is neither logged, nor does it trigger an alert (Shastri, 2022). To help better understand Kerberoasting, the following section provides several case studies.

***

#### Table of Contents
{: .no_toc}

<ul><li> <a href="/docs/K/Kerberoasting-Case-Studies-of-an-Attack-on-a-Cryptographic-Authentication-Technology-1/">Introduction</a></li><li> <a href="/docs/K/Kerberoasting-Case-Studies-of-an-Attack-on-a-Cryptographic-Authentication-Technology-2/">Literature Review</a></li><li> <a href="/docs/K/Kerberoasting-Case-Studies-of-an-Attack-on-a-Cryptographic-Authentication-Technology-3/">Kerberoasting Case Studies</a></li><li> <a href="/docs/K/Kerberoasting-Case-Studies-of-an-Attack-on-a-Cryptographic-Authentication-Technology-4/">Detecting Kerberoasting Attacks</a></li><li> <a href="/docs/K/Kerberoasting-Case-Studies-of-an-Attack-on-a-Cryptographic-Authentication-Technology-5/">Mitigation of Kerberoasting</a></li><li> <a href="/docs/K/Kerberoasting-Case-Studies-of-an-Attack-on-a-Cryptographic-Authentication-Technology-6/">Policy Implications</a></li><li> <a href="/docs/K/Kerberoasting-Case-Studies-of-an-Attack-on-a-Cryptographic-Authentication-Technology-7/">Conclusion</a></li><li> <a href="/docs/K/Kerberoasting-Case-Studies-of-an-Attack-on-a-Cryptographic-Authentication-Technology-8/">References</a></li></ul>

***

</div>
